name: Create Branch on Tag Push

on:
  push:
    tags:
      - '*'

jobs:
  create-branch:
    runs-on: ubuntu-latest
    if: ${{ github.repository == 'pantheon-systems/search_api_pantheon' }}
    env:
      BRANCH: ${{ github.ref_name }}
      WORKSPACE: ${{ github.workspace }}
      DRUPAL_ORG_REMOTE: ${{ secrets.DRUPAL_ORG_REMOTE }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Extract tag name
        id: tag_name
        run: |
          FULL_TAG=${GITHUB_REF#refs/tags/}
          MAJOR_MINOR=$(echo $FULL_TAG | cut -d '.' -f 1,2)
          echo "::set-output name=TAG_NAME::$MAJOR_MINOR"
      - name: Print the thing
        run: echo $TAG_NAME
      - name: Create branch from tag
        run: git branch ${{ steps.tag_name.outputs.TAG_NAME }} ${{ github.ref }} && git push origin ${{ steps.tag_name.outputs.TAG_NAME }}

